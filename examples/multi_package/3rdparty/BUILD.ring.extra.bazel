# Content based on https://github.com/briansmith/ring/blob/9cc0d45f4d8521f467bb3a621e74b1535e118188/build.rs

load("@rules_cc//cc:defs.bzl", "cc_library")

X86 = "x86"
X86_64 = "x86_64"
AARCH64 = "aarch64"
ARM = "arm"

SHA256_X86_64 = "crypto/fipsmodule/sha/asm/sha256-x86_64.pl"
SHA512_X86_64 = "crypto/fipsmodule/sha/asm/sha512-x86_64.pl"

SHA256_ARMV8 = "crypto/fipsmodule/sha/asm/sha256-armv8.pl"
SHA512_ARMV8 = "crypto/fipsmodule/sha/asm/sha512-armv8.pl"

RING_SRCS = [
    ([], "crypto/fipsmodule/aes/aes_nohw.c"),
    ([], "crypto/fipsmodule/bn/montgomery.c"),
    ([], "crypto/fipsmodule/bn/montgomery_inv.c"),
    ([], "crypto/limbs/limbs.c"),
    ([], "crypto/mem.c"),
    ([], "crypto/poly1305/poly1305.c"),

    ([AARCH64, ARM, X86_64, X86], "crypto/crypto.c"),
    ([AARCH64, ARM, X86_64, X86], "crypto/curve25519/curve25519.c"),
    ([AARCH64, ARM, X86_64, X86], "crypto/fipsmodule/ec/ecp_nistz.c"),
    ([AARCH64, ARM, X86_64, X86], "crypto/fipsmodule/ec/ecp_nistz256.c"),
    ([AARCH64, ARM, X86_64, X86], "crypto/fipsmodule/ec/gfp_p256.c"),
    ([AARCH64, ARM, X86_64, X86], "crypto/fipsmodule/ec/gfp_p384.c"),

    ([X86_64, X86], "crypto/cpu-intel.c"),

    ([X86], "crypto/fipsmodule/aes/asm/aesni-x86.pl"),
    ([X86], "crypto/fipsmodule/aes/asm/vpaes-x86.pl"),
    ([X86], "crypto/fipsmodule/bn/asm/x86-mont.pl"),
    ([X86], "crypto/chacha/asm/chacha-x86.pl"),
    ([X86], "crypto/fipsmodule/ec/asm/ecp_nistz256-x86.pl"),
    ([X86], "crypto/fipsmodule/modes/asm/ghash-x86.pl"),

    ([X86_64], "crypto/fipsmodule/aes/asm/aesni-x86_64.pl"),
    ([X86_64], "crypto/fipsmodule/aes/asm/vpaes-x86_64.pl"),
    ([X86_64], "crypto/fipsmodule/bn/asm/x86_64-mont.pl"),
    ([X86_64], "crypto/fipsmodule/bn/asm/x86_64-mont5.pl"),
    ([X86_64], "crypto/chacha/asm/chacha-x86_64.pl"),
    ([X86_64], "crypto/fipsmodule/ec/asm/p256-x86_64-asm.pl"),
    ([X86_64], "crypto/fipsmodule/modes/asm/aesni-gcm-x86_64.pl"),
    ([X86_64], "crypto/fipsmodule/modes/asm/ghash-x86_64.pl"),
    ([X86_64], "crypto/poly1305/poly1305_vec.c"),
    ([X86_64], SHA512_X86_64),
    ([X86_64], "crypto/cipher_extra/asm/chacha20_poly1305_x86_64.pl"),

    ([AARCH64, ARM], "crypto/fipsmodule/aes/asm/aesv8-armx.pl"),
    ([AARCH64, ARM], "crypto/fipsmodule/modes/asm/ghashv8-armx.pl"),

    ([ARM], "crypto/fipsmodule/aes/asm/bsaes-armv7.pl"),
    ([ARM], "crypto/fipsmodule/aes/asm/vpaes-armv7.pl"),
    ([ARM], "crypto/fipsmodule/bn/asm/armv4-mont.pl"),
    ([ARM], "crypto/chacha/asm/chacha-armv4.pl"),
    ([ARM], "crypto/curve25519/asm/x25519-asm-arm.S"),
    ([ARM], "crypto/fipsmodule/ec/asm/ecp_nistz256-armv4.pl"),
    ([ARM], "crypto/fipsmodule/modes/asm/ghash-armv4.pl"),
    ([ARM], "crypto/poly1305/poly1305_arm.c"),
    ([ARM], "crypto/poly1305/poly1305_arm_asm.S"),
    ([ARM], "crypto/fipsmodule/sha/asm/sha256-armv4.pl"),
    ([ARM], "crypto/fipsmodule/sha/asm/sha512-armv4.pl"),

    ([AARCH64], "crypto/fipsmodule/aes/asm/vpaes-armv8.pl"),
    ([AARCH64], "crypto/fipsmodule/bn/asm/armv8-mont.pl"),
    ([AARCH64], "crypto/chacha/asm/chacha-armv8.pl"),
    ([AARCH64], "crypto/fipsmodule/ec/asm/ecp_nistz256-armv8.pl"),
    ([AARCH64], "crypto/fipsmodule/modes/asm/ghash-neon-armv8.pl"),
    ([AARCH64], SHA512_ARMV8),
]

RING_INCLUDES = [
    "crypto/curve25519/curve25519_tables.h",
    "crypto/curve25519/internal.h",
    "crypto/fipsmodule/bn/internal.h",
    "crypto/fipsmodule/ec/ecp_nistz256_table.inl",
    "crypto/fipsmodule/ec/ecp_nistz384.inl",
    "crypto/fipsmodule/ec/ecp_nistz.h",
    "crypto/fipsmodule/ec/ecp_nistz384.h",
    "crypto/fipsmodule/ec/ecp_nistz256.h",
    "crypto/internal.h",
    "crypto/limbs/limbs.h",
    "crypto/limbs/limbs.inl",
    "crypto/poly1305/internal.h",
    "include/GFp/aes.h",
    "include/GFp/arm_arch.h",
    "include/GFp/base.h",
    "include/GFp/check.h",
    "include/GFp/cpu.h",
    "include/GFp/mem.h",
    "include/GFp/poly1305.h",
    "include/GFp/type_check.h",
    "third_party/fiat/curve25519_32.h",
    "third_party/fiat/curve25519_64.h",
]

RING_PERL_INCLUDES =[
    "crypto/perlasm/arm-xlate.pl",
    "crypto/perlasm/x86gas.pl",
    "crypto/perlasm/x86nasm.pl",
    "crypto/perlasm/x86asm.pl",
    "crypto/perlasm/x86_64-xlate.pl",
]

cc_library(
    name = "ring_lib",

)
